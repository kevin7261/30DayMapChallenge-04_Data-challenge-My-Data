(function(){"use strict";var e={5102:function(e,t,n){var a=n(5130),r=n(657),o=n(6768);const l={id:"app",class:"d-flex flex-column vh-100"},s={class:"d-flex flex-column overflow-hidden"};function i(e,t,n,a,r,i){const c=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",l,[(0,o.Lk)("div",s,[(0,o.bF)(c)])])}var c=n(144),u={name:"App",components:{},setup(){const e=(0,c.KR)(!1),t=(0,c.KR)("載入中..."),n=(0,c.KR)(0),a=(0,c.KR)(!1),r=(0,c.KR)("");return{isLoading:e,loadingText:t,loadingProgress:n,showLoadingProgress:a,loadingSubText:r}}},d=n(1241);const p=(0,d.A)(u,[["render",i]]);var y=p,f=n(1387),g=n(4232);const v={id:"app",class:"d-flex flex-column vh-100"},m={class:"flex-grow-1 overflow-hidden position-relative"},h={class:"position-absolute",style:{top:"50%",left:"0",transform:"translateY(-50%)","z-index":"1000",padding:"1rem"}},b={class:"bg-dark bg-opacity-75 rounded-3 p-3"},w={class:""},T={class:"d-flex flex-column gap-1"},C=["onClick"];function M(e,t,n,a,r,l){const s=(0,o.g2)("MapTab");return(0,o.uX)(),(0,o.CE)("div",v,[(0,o.Lk)("div",m,[(0,o.bF)(s,{onMapReady:a.setMapInstance,"current-country":a.currentCountry},null,8,["onMapReady","current-country"]),(0,o.Lk)("div",h,[(0,o.Lk)("div",b,[(0,o.Lk)("div",w,[(0,o.Lk)("div",T,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.countries,(e=>((0,o.uX)(),(0,o.CE)("button",{key:e.layerId,class:(0,g.C4)(["btn border-0 my-country-btn my-font-sm-white px-4 py-3",[a.currentCountry===e.layerName?"active":""]]),onClick:t=>a.navigateToCountry(e.layerId)},(0,g.v_)(e.layerName),11,C)))),128))])])])])])])}n(8111),n(116);const A={id:"map-container",class:"h-100 w-100 position-relative bg-transparent z-0"},k=["id"];function x(e,t,n,a,r,l){return(0,o.uX)(),(0,o.CE)("div",A,[(0,o.Lk)("div",{id:a.mapContainerId,ref:"mapContainer",class:"h-100 w-100"},null,8,k)])}n(4114);var I=n(5769);n(3579);const L=(0,r.nY)("data",(()=>{const e=16,t=(0,c.KR)([{groupName:"世界國家",groupLayers:[{layerId:"Taiwan",layerName:"TAIWAN",center:[120.982025,23.973875]},{layerId:"China",layerName:"CHINA",center:[116.39162,39.89898]},{layerId:"Japan",layerName:"JAPAN",center:[139.774167,35.684444]},{layerId:"UnitedStates",layerName:"UNITED STATES",center:[-77.036548,38.895108]},{layerId:"France",layerName:"FRANCE",center:[2.3488,48.8534]},{layerId:"Germany",layerName:"GERMANY",center:[13.399,52.5108]}]}]),n=(0,c.KR)("Taiwan"),a=(0,c.KR)(["Australia","Austria","Belgium","China","Czechia","Denmark","Estonia","Finland","France","Germany","Greece","Greenland","Hungary","Iceland","Italy","Japan","Laos","Luxembourg","Malaysia","Mexico","Mongolia","Netherlands","North Korea","Norway","Philippines","Poland","Qatar","Singapore","Slovakia","South Korea","Spain","Sweden","Switzerland","Thailand","United Kingdom","United States of America","Vietnam"]),r=e=>!!e&&e.trim()===n.value,l=e=>{if(!e)return!1;const t=e.trim();return a.value.some((e=>t===e||!(!t.includes(e)&&!e.includes(t))))},s=e=>{for(const n of t.value)for(const t of n.groupLayers)if(t.layerId===e)return t;return null},i=()=>{const e=[];for(const n of t.value)e.push(...n.groupLayers);return e},u=(0,c.KR)(null),d=e=>{u.value=e},p=(0,c.KR)(null),y=e=>{p.value=e},f=t=>{const n=s(t);if(!n)return void console.error("❌ 找不到國家圖層:",t);if(!p.value)return console.error("❌ 地圖實例未準備就緒，等待地圖初始化..."),void setTimeout((()=>{p.value?(console.log("🌍 地圖已準備就緒，重新嘗試移動"),f(t)):console.error("❌ 地圖實例仍未準備就緒")}),1e3);const a=n.center,r=e;try{p.value.navigateToLocation&&(p.value.navigateToLocation(a,r),console.log(`🌍 成功導航到國家: ${n.layerName}`))}catch(o){console.error("❌ 地圖導航失敗:",o)}};return{layers:t,findLayerById:s,getAllLayers:i,selectedFeature:u,setSelectedFeature:d,mapInstance:p,setMapInstance:y,navigateToCountry:f,homeCountry:n,isHomeCountry:r,visitedCountries:a,isCountryVisited:l,visibleLayers:(0,o.EW)((()=>i()))}}),{persist:!0}),N=(0,r.nY)("define",{state:()=>({selectedBasemap:"carto_dark",mapView:{center:[25.04583,121.51972],zoom:16},basemaps:[{label:"Carto Dark",value:"carto_dark",url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png"}]}),actions:{setSelectedBasemap(e){this.selectedBasemap=e},setMapView(e,t){this.mapView.center=e,this.mapView.zoom=t}}});var R={name:"MapTab",props:{currentCountry:{type:String,default:"國家名稱"}},emits:["map-ready"],setup(e,{emit:t}){const n=L(),a=N(),r=(0,c.KR)(null),l=(0,c.KR)(null);let s=null,i=null,u=null,d=null,p=null,y=null;const f=(0,c.KR)(!1),g=(0,c.KR)(`d3-map-${Math.random().toString(36).substr(2,9)}`),v=(0,c.KR)(null),m=(0,o.EW)((()=>n.getAllLayers().length>0)),h=(0,o.EW)((()=>{if(!e.currentCountry)return null;const t=n.getAllLayers(),a=t.find((t=>t.layerName===e.currentCountry));return a?{}:null})),b=async()=>{try{console.log("[MapTab] 開始載入 GeoJSON 數據...");const e=await fetch("/30DayMapChallenge-04_Data-challenge-My-Data/data/ne_110m_admin_0_countries.geojson");if(!e.ok)throw new Error(`HTTP 錯誤! 狀態: ${e.status}`);const t=await e.json();return v.value=t,console.log("[MapTab] 世界地圖數據載入成功，特徵數量:",t.features?.length),!0}catch(e){return console.error("[MapTab] 世界地圖數據載入失敗:",e),!1}},w=()=>{if(!r.value)return!1;const e=r.value.getBoundingClientRect();if(0===e.width||0===e.height)return console.warn("[MapTab] 容器尺寸為零，延遲初始化"),!1;try{const n=e.width,a=e.height;s=I.Ltv(r.value).append("svg").attr("width",n).attr("height",a).style("background","#f0f0f0"),l.value=s.node();const o=32,c=n-2*o,y=a-2*o,g=Math.min(c,y)/6;i=I.ANm().rotate([-120.982025,-23.973875]).scale(g).translate([n/2,a/2]).clipAngle(180),u=I.zFW().projection(i),p=s.append("g"),d=I.s_O().scaleExtent([1,1]).on("zoom",null),s.call(d).on("wheel.zoom",null).on("dblclick.zoom",null),f.value=!0;const v={svg:s,projection:i,path:u,navigateToLocation:e=>M(e)};return t("map-ready",v),console.log("[MapTab] D3 地圖創建成功"),!0}catch(n){return console.error("[MapTab] D3 地圖創建失敗:",n),!1}},T=()=>{if(!s||!i||!r.value)return;const[e,t]=i.translate(),n=i.scale(),a=6371008.8,o=5e6,l=15e6,c=[];for(let r=1;r<=3;r++){const e=o*r;if(e>l)break;const t=n*(e/a);c.push({index:r,radiusPx:t,type:"distance"})}const u=n*Math.PI;c.push({index:999,radiusPx:u,type:"boundary"}),y||(y=s.append("g").attr("class","rings-overlay").style("pointer-events","none")),y.raise();const d=y.selectAll("circle.ring").data(c,(e=>e.index));d.enter().append("circle").attr("class","ring").attr("fill","none").merge(d).attr("cx",e).attr("cy",t).attr("r",(e=>e.radiusPx)).attr("stroke",(e=>"boundary"===e.type?"#666666":"#cccccc")).attr("stroke-width",(e=>"boundary"===e.type?2:1)).attr("stroke-dasharray",(e=>"boundary"===e.type?"none":"6,6")),d.exit().remove()},C=async()=>{if(p&&v.value)try{const e=v.value;console.log("[MapTab] 開始繪製地圖，國家數量:",e.features?.length),p.selectAll("path").data(e.features).enter().append("path").attr("d",u).attr("fill",(e=>{const t=e.properties.name||e.properties.ADMIN||e.properties.NAME;return n.isHomeCountry(t)?"#ff9999":n.isCountryVisited(t)?"#cce5ff":"#d0d0d0"})).attr("stroke","#666666").attr("stroke-width",.5).attr("class","country"),console.log("[MapTab] 世界地圖繪製完成，已繪製",e.features?.length,"個國家")}catch(e){console.error("[MapTab] 世界地圖繪製失敗:",e)}else console.error("[MapTab] 無法繪製地圖: g=",!!p,"worldData=",!!v.value)},M=e=>{if(!s||!i)return;const t=r.value.getBoundingClientRect(),n=t.width,a=t.height,o=32,l=n-2*o,c=a-2*o,d=Math.min(l,c)/6;i.rotate([-e[0],-e[1]]).scale(d),p.selectAll("path.country").attr("d",u),T(),console.log("[MapTab] 地圖導航完成，中心:",e)},A=()=>{if(!s||!r.value)return;const e=r.value.getBoundingClientRect(),t=e.width,n=e.height;s.attr("width",t).attr("height",n);const a=32,o=t-2*a,l=n-2*a,c=Math.min(o,l)/6;i.translate([t/2,n/2]).scale(c),p.selectAll("path.country").attr("d",u),T(),console.log("[MapTab] 地圖尺寸更新完成")},k=async()=>{let e=0;const t=20,n=await b();if(!n)return void console.error("[MapTab] 無法載入世界地圖數據");const a=async()=>{e>=t?console.error("[MapTab] 地圖初始化失敗，已達到最大嘗試次數"):(e++,console.log(`[MapTab] 嘗試創建地圖 (${e}/${t})`),w()?(console.log("[MapTab] 地圖創建成功，開始繪製世界地圖"),await C(),T()):(console.log("[MapTab] 地圖創建失敗，100ms 後重試"),setTimeout(a,100)))};a()};let x=null,R=null;const _=()=>{r.value&&window.ResizeObserver&&(x=new ResizeObserver((()=>{R&&clearTimeout(R),R=setTimeout((()=>{console.log("🔄 容器大小變化，刷新地圖"),A()}),200)})),x.observe(r.value),console.log("✅ ResizeObserver 已設置"))};return(0,o.sV)((()=>{(0,o.dY)((()=>{k(),_()}))})),(0,o.hi)((()=>{R&&clearTimeout(R),x&&x.disconnect(),s&&(s.remove(),s=null),i=null,u=null,d=null,p=null,f.value=!1})),(0,o.wB)((()=>n.layers),(()=>{f.value}),{deep:!0}),(0,o.wB)((()=>e.currentCountry),(e=>{if(f.value&&e){const t=n.getAllLayers(),a=t.find((t=>t.layerName===e));a&&M(a.center)}})),{mapContainer:r,mapContainerId:g,isAnyLayerVisible:m,currentCountryInfo:h,invalidateSize:A,defineStore:a,navigateToLocation:M}}};const _=(0,d.A)(R,[["render",x],["__scopeId","data-v-942f9c48"]]);var E=_,K={name:"HomeView",components:{MapTab:E},setup(){const e=L(),t=N(),n=t=>e.setMapInstance(t),a=t=>{const n=r.value?.find((e=>e.layerId===t));n&&(console.log("🌍 切換到國家:",n.layerName),l.value=n.layerName),e.navigateToCountry(t)},r=(0,o.EW)((()=>e.layers[0].groupLayers)),l=(0,c.KR)("TAIWAN");return(0,o.sV)((()=>{a("Taiwan")})),{setMapInstance:n,navigateToCountry:a,countries:r,defineStore:t,currentCountry:l}}};const S=(0,d.A)(K,[["render",M]]);var O=S;const z=[{path:"/",name:"Home",component:O}],D=(0,f.aE)({history:(0,f.LA)("/30DayMapChallenge-04_Data-challenge-My-Data/"),routes:z});var P=D;n(323);console.log("🎨 樣式文件載入完成");const F=(0,a.Ef)(y),V=(0,r.Ey)();F.use(P),F.use(V),F.mount("#app"),console.log("🚀 空間分析視覺化平台已啟動"),console.log("📦 Pinia 狀態管理已初始化"),console.log("🗺️ Vue Router 路由系統已就緒"),console.log("🎨 Bootstrap 5 UI 框架已載入"),console.log("🗺️ D3.js 地圖庫已準備就緒"),console.log("🔤 Font Awesome 圖示庫已載入")}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(t,a,r,o){if(!a){var l=1/0;for(u=0;u<e.length;u++){a=e[u][0],r=e[u][1],o=e[u][2];for(var s=!0,i=0;i<a.length;i++)(!1&o||l>=o)&&Object.keys(n.O).every((function(e){return n.O[e](a[i])}))?a.splice(i--,1):(s=!1,o<l&&(l=o));if(s){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[a,r,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,o,l=a[0],s=a[1],i=a[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(i)var u=i(n)}for(t&&t(a);c<l.length;c++)o=l[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(u)},a=self["webpackChunk_30daymapchallenge_04_data_challenge_my_data"]=self["webpackChunk_30daymapchallenge_04_data_challenge_my_data"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(5102)}));a=n.O(a)})();
//# sourceMappingURL=app.7f152b6d.js.map